#!/bin/sh
#
# Window manager.
# Dependencies: wmutils, wew, xwinfo

on_xcb_create_notify() {
  # shellcheck disable=SC2046
  wmv -a $(wmp) "$1"
  case $(xwinfo -c "$1") in
    URxvt) compton-trans 90 -w "$1" ;;
  esac
}

on_xcb_map_notify() {
  focus.sh "$1"
}

on_xcb_unmap_notify() {
  # Don't remap if the window was unmapped by some other visible window.
  wattr m "$(pfw)" || focus.sh prev
}

main() {
  wew | while IFS=: read -r ev wid; do
    wattr o "$wid" ||
    case $ev in
      16) on_xcb_create_notify "$wid" ;;
      19) on_xcb_map_notify "$wid" ;;
      18) on_xcb_unmap_notify "$wid" ;;
    esac
  done
}

main
